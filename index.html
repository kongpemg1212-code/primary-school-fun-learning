<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小学生趣味学习系统</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .font-kids { font-family: 'ZCOOL XiaoWei', serif; }
        .paper-bg { background-color: #fdf6e3; background-image: radial-gradient(#eee8d5 1px, transparent 0); background-size: 20px 20px; }
        .hidden-word { color: transparent; border-bottom: 2px dashed #93a1a1; margin: 0 4px; padding: 0 8px; transition: all 0.3s; }
        .hidden-word:hover { color: rgba(147, 161, 161, 0.3); }
        [v-cloak] { display: none; }
        .tab-active { @apply bg-white shadow-md text-blue-600; }
    </style>
</head>
<body class="paper-bg min-h-screen text-slate-800">
    <div id="app" v-cloak class="max-w-2xl mx-auto p-4 md:p-8">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8 bg-white/50 backdrop-blur p-4 rounded-3xl border border-slate-200">
            <h1 class="text-2xl font-black text-blue-600 flex items-center gap-2">
                <i class="ph-fill ph-graduation-cap"></i> 趣味学习
            </h1>
            <div class="flex gap-2">
                <button @click="subject = 'Chinese'" :class="['px-4 py-2 rounded-xl text-sm font-bold transition', subject === 'Chinese' ? 'bg-orange-500 text-white shadow-lg' : 'bg-slate-200 text-slate-500']">语文</button>
                <button @click="subject = 'Math'" :class="['px-4 py-2 rounded-xl text-sm font-bold transition', subject === 'Math' ? 'bg-blue-500 text-white shadow-lg' : 'bg-slate-200 text-slate-500']">数学</button>
            </div>
        </header>

        <!-- Lesson List -->
        <div v-if="!currentLesson" class="space-y-4 animate-fade-in">
            <h2 class="text-xl font-bold flex items-center gap-2"><i class="ph-bold ph-list"></i> 课程列表</h2>
            <div class="grid grid-cols-1 gap-4">
                <button v-for="lesson in filteredLessons" :key="lesson.id" @click="selectLesson(lesson)" class="group p-6 bg-white rounded-3xl border-2 border-transparent hover:border-orange-400 hover:shadow-xl transition-all text-left flex items-center justify-between">
                    <div>
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">{{ lesson.subject === 'Chinese' ? '语文' : '数学' }}</div>
                        <div class="text-xl font-black group-hover:text-orange-600">{{ lesson.title }}</div>
                    </div>
                    <i class="ph-bold ph-caret-right text-slate-300 group-hover:translate-x-1 transition-transform"></i>
                </button>
            </div>
        </div>

        <!-- Content View -->
        <div v-else class="animate-fade-in">
            <button @click="currentLesson = null" class="mb-4 flex items-center gap-1 text-slate-400 font-bold hover:text-slate-600 transition">
                <i class="ph-bold ph-arrow-left"></i> 返回列表
            </button>

            <!-- 语文模块：背诵神器 -->
            <div v-if="currentLesson.subject === 'Chinese'" class="space-y-6">
                <div class="bg-white rounded-[2.5rem] p-8 shadow-2xl border border-orange-100 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-orange-500"></div>
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-kids font-black mb-2">{{ currentLesson.title }}</h2>
                        <div class="text-sm text-slate-400">{{ currentLesson.content.category }}</div>
                    </div>

                    <!-- 渐进挖空控制栏 -->
                    <div class="flex justify-center gap-2 mb-10 bg-slate-100 p-2 rounded-2xl">
                        <button v-for="n in 4" :key="n" @click="poemStep = n" :class="['flex-1 py-2 rounded-xl text-xs font-black transition', poemStep === n ? 'bg-white shadow-sm text-orange-600' : 'text-slate-400']">
                            第 {{ n }} 关
                        </button>
                    </div>

                    <!-- 课文内容 -->
                    <div class="flex flex-col items-center space-y-6">
                        <div v-for="(line, idx) in currentLesson.content.sentences" :key="idx" class="text-2xl md:text-3xl font-kids tracking-wider leading-relaxed">
                            <template v-for="(char, cIdx) in line.split('')">
                                <span :class="{'hidden-word': isHidden(char, cIdx, idx)}">{{ char }}</span>
                            </template>
                        </div>
                    </div>
                    
                    <div class="mt-12 text-center">
                        <div class="text-[10px] text-slate-300 uppercase tracking-widest font-black">当前挑战</div>
                        <div class="text-sm font-bold text-orange-400 mt-1">{{ stepDescription }}</div>
                    </div>
                </div>
            </div>

            <!-- 数学模块：占位 -->
            <div v-if="currentLesson.subject === 'Math'" class="bg-white rounded-[2.5rem] p-8 shadow-2xl border border-blue-100 flex flex-col items-center justify-center min-h-[300px]">
                <i class="ph-fill ph-compass-tool text-6xl text-blue-200 mb-4"></i>
                <h3 class="text-xl font-black text-blue-600 mb-2">{{ currentLesson.title }}</h3>
                <p class="text-slate-400 text-center">几何交互画布开发中...<br>即将支持长方形、三角形顶点拖拽</p>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    subject: 'Chinese',
                    lessons: [],
                    currentLesson: null,
                    poemStep: 1 // 1: 全显, 2: 挖词, 3: 留首字, 4: 全空
                }
            },
            computed: {
                filteredLessons() {
                    return this.lessons.filter(l => l.subject === this.subject);
                },
                stepDescription() {
                    const desc = {
                        1: "朗读阶段：熟悉课文内容",
                        2: "初级挑战：找出并补全动词",
                        3: "中级挑战：根据首字背诵全句",
                        4: "终极挑战：闭眼默背整篇"
                    };
                    return desc[this.poemStep];
                }
            },
            async mounted() {
                await this.fetchData();
            },
            methods: {
                async fetchData() {
                    try {
                        const res = await fetch('data/lessons.json?t=' + Date.now());
                        this.lessons = await res.json();
                    } catch (e) {
                        console.error("Data load failed", e);
                    }
                },
                selectLesson(lesson) {
                    this.currentLesson = lesson;
                    this.poemStep = 1;
                },
                isHidden(char, charIdx, lineIdx) {
                    if (this.poemStep === 1) return false;
                    if (this.poemStep === 4) return true;
                    if (this.poemStep === 3) return charIdx > 0; // 只留第一个字
                    if (this.poemStep === 2) {
                        // 语文课文中的动词挖空逻辑 (示例匹配：吹、落、降、飘)
                        const keywords = ['吹', '落', '降', '飘'];
                        return keywords.includes(char);
                    }
                    return false;
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
